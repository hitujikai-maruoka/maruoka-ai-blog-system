name: ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹è‡ªå‹•ãƒ–ãƒ­ã‚°ç”Ÿæˆ

on:
  # å®šæœŸå®Ÿè¡Œï¼ˆæ¯æ—¥21æ™‚ JST = 12æ™‚ UTCï¼‰
  schedule:
    - cron: '0 12 * * *'
  
  # æ‰‹å‹•å®Ÿè¡Œ
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ'
        required: false
        default: 'false'
        type: choice
        options:
        - 'true'
        - 'false'

jobs:
  process-episodes:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ğŸ‘ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: ğŸ”§ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          npm install
          npm install googleapis google-auth-library
          
      - name: ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæº–å‚™
        run: mkdir -p data
          
      - name: ğŸš€ ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰å‡¦ç†å®Ÿè¡Œ
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          STANDFM_RSS_URL: ${{ secrets.STANDFM_RSS_URL }}
          STANDFM_CHANNEL_ID: ${{ secrets.STANDFM_CHANNEL_ID }}
          TEST_MODE: ${{ github.event.inputs.test_mode || 'false' }}
        run: |
          echo "ğŸš€ ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹è‡ªå‹•ãƒ–ãƒ­ã‚°ç”Ÿæˆé–‹å§‹"
          echo "å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰: $TEST_MODE"
          echo "å®Ÿè¡Œæ™‚åˆ»ï¼ˆJSTï¼‰: $(TZ=Asia/Tokyo date)"
          
          if [ "$TEST_MODE" = "true" ]; then
            echo "ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ"
            node src/index.js --test
          else
            echo "ğŸ¯ æœ¬æ ¼ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ"
            node src/index.js
          fi
          
      - name: ğŸ“§ Gmailçµ±åˆæ©Ÿèƒ½ï¼ˆè¨˜äº‹å®Œæˆé€šçŸ¥ï¼‰
        if: success()
        env:
          GMAIL_CREDENTIALS_JSON: ${{ secrets.GMAIL_CREDENTIALS_JSON }}
          GMAIL_TOKEN_JSON: ${{ secrets.GMAIL_TOKEN_JSON }}
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          TEST_MODE: ${{ github.event.inputs.test_mode || 'false' }}
        run: |
          echo "ğŸ“§ Gmailçµ±åˆæ©Ÿèƒ½é–‹å§‹"
          echo "ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰: $TEST_MODE"
          
          cat > gmail-integration-main.js << 'EOF'
          const { Client } = require('@notionhq/client');
          const { google } = require('googleapis');
          
          async function sendCompletionNotifications() {
              try {
                  console.log('ğŸ“§ è¨˜äº‹å®Œæˆé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹');
                  console.log(`ğŸ”§ ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰: ${process.env.TEST_MODE}`);
                  
                  // Notionæ¥ç¶š
                  const notion = new Client({ auth: process.env.NOTION_API_KEY });
                  const databaseId = process.env.NOTION_DATABASE_ID;
                  
                  // GmailåˆæœŸåŒ–
                  console.log('ğŸ”— Gmailèªè¨¼é–‹å§‹...');
                  const credentials = JSON.parse(process.env.GMAIL_CREDENTIALS_JSON);
                  const token = JSON.parse(process.env.GMAIL_TOKEN_JSON);
                  
                  const auth = new google.auth.OAuth2(
                      credentials.client_id,
                      credentials.client_secret,
                      credentials.redirect_uris[0]
                  );
                  auth.setCredentials(token);
                  
                  const gmail = google.gmail({ version: 'v1', auth: auth });
                  
                  // Gmailæ¥ç¶šç¢ºèª
                  const profile = await gmail.users.getProfile({ userId: 'me' });
                  console.log(`âœ… Gmailèªè¨¼å®Œäº†: ${profile.data.emailAddress}`);
                  
                  // æœ€æ–°ã®è¨˜äº‹ã‚’å–å¾—ï¼ˆæœ¬æ—¥ä½œæˆã•ã‚ŒãŸè¨˜äº‹ï¼‰
                  const today = new Date();
                  const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                  
                  console.log(`ğŸ“… æ¤œç´¢é–‹å§‹æ—¥æ™‚: ${todayStart.toISOString()}`);
                  
                  const recentArticles = await notion.databases.query({
                      database_id: databaseId,
                      filter: {
                          property: 'Created',
                          date: {
                              on_or_after: todayStart.toISOString()
                          }
                      },
                      sorts: [
                          {
                              property: 'Created',
                              direction: 'descending'
                          }
                      ],
                      page_size: 10
                  });
                  
                  console.log(`ğŸ“‹ æœ¬æ—¥ä½œæˆã•ã‚ŒãŸè¨˜äº‹: ${recentArticles.results.length} ä»¶`);
                  
                  if (recentArticles.results.length === 0) {
                      console.log('ğŸ“ æ–°ã—ã„è¨˜äº‹ãŒãªã„ãŸã‚ã€Gmailé€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');
                      
                      // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ã€æ—¢å­˜è¨˜äº‹ã®æœ€æ–°3ä»¶ã§ãƒ†ã‚¹ãƒˆ
                      if (process.env.TEST_MODE === 'true') {
                          console.log('ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰: æ—¢å­˜è¨˜äº‹ã§ãƒ†ã‚¹ãƒˆé€ä¿¡ã‚’å®Ÿè¡Œ');
                          
                          const existingArticles = await notion.databases.query({
                              database_id: databaseId,
                              sorts: [
                                  {
                                      property: 'Created',
                                      direction: 'descending'
                                  }
                              ],
                              page_size: 3
                          });
                          
                          if (existingArticles.results.length > 0) {
                              console.log(`ğŸ§ª ãƒ†ã‚¹ãƒˆå¯¾è±¡è¨˜äº‹: ${existingArticles.results.length} ä»¶`);
                              await processArticles(gmail, notion, existingArticles.results, true);
                          } else {
                              console.log('ğŸ“ æ—¢å­˜è¨˜äº‹ã‚‚è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                          }
                      }
                      return;
                  }
                  
                  // è¨˜äº‹å‡¦ç†
                  await processArticles(gmail, notion, recentArticles.results, false);
                  
              } catch (error) {
                  console.error(`âŒ Gmailçµ±åˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                  console.error('ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹:', error.stack);
                  throw error;
              }
          }
          
          async function processArticles(gmail, notion, articles, isTestMode) {
              // æœ€æ–°3ä»¶ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡
              const articlesToNotify = articles.slice(0, 3);
              console.log(`ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¯¾è±¡: ${articlesToNotify.length} ä»¶${isTestMode ? ' (ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰)' : ''}`);
              
              for (let i = 0; i < articlesToNotify.length; i++) {
                  const article = articlesToNotify[i];
                  
                  const title = article.properties.Title?.title?.[0]?.text?.content || 'æ–°ã—ã„è¨˜äº‹';
                  const episodeId = article.properties['Episode ID']?.rich_text?.[0]?.text?.content || '';
                  const createdTime = article.properties.Created?.date?.start || new Date().toISOString();
                  const status = article.properties.Status?.select?.name || 'æœªè¨­å®š';
                  
                  console.log(`ğŸ“§ [${i + 1}/${articlesToNotify.length}] ãƒ¡ãƒ¼ãƒ«é€ä¿¡: ${title}`);
                  console.log(`   ğŸ“… ä½œæˆæ—¥æ™‚: ${createdTime}`);
                  console.log(`   ğŸ·ï¸ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${status}`);
                  
                  // è¨˜äº‹å†…å®¹å–å¾—
                  let content = '';
                  try {
                      const pageContent = await notion.blocks.children.list({
                          block_id: article.id,
                          page_size: 50
                      });
                      
                      const textBlocks = pageContent.results
                          .filter(block => block.type === 'paragraph' && block.paragraph?.rich_text?.length > 0)
                          .map(block => block.paragraph.rich_text.map(text => text.plain_text).join(''))
                          .join('\n\n');
                          
                      content = textBlocks || 'è¨˜äº‹å†…å®¹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
                      console.log(`   ğŸ“ è¨˜äº‹å†…å®¹é•·: ${content.length} æ–‡å­—`);
                  } catch (error) {
                      content = 'è¨˜äº‹å†…å®¹ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                      console.log(`   âš ï¸ è¨˜äº‹å†…å®¹å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                  }
                  
                  // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
                  await sendNotificationEmail(gmail, {
                      title: title,
                      content: content,
                      notionUrl: `https://notion.so/${article.id.replace(/-/g, '')}`,
                      episodeId: episodeId,
                      createdTime: createdTime,
                      status: status,
                      index: i + 1,
                      total: articlesToNotify.length,
                      isTestMode: isTestMode
                  });
                  
                  // APIåˆ¶é™å¯¾ç­–
                  if (i < articlesToNotify.length - 1) {
                      await new Promise(resolve => setTimeout(resolve, 2000));
                  }
              }
              
              console.log('ğŸ‰ Gmailçµ±åˆæ©Ÿèƒ½å®Œäº†ï¼');
              console.log('ğŸ“± hitujikai.maruoka@gmail.com ã®å—ä¿¡ç®±ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
          }
          
          async function sendNotificationEmail(gmail, data) {
              try {
                  const jstTime = new Date().toLocaleString('ja-JP', { 
                      timeZone: 'Asia/Tokyo',
                      year: 'numeric',
                      month: '2-digit',
                      day: '2-digit',
                      hour: '2-digit',
                      minute: '2-digit',
                      second: '2-digit'
                  });
                  
                  const subject = `[ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹] ${data.isTestMode ? 'ãƒ†ã‚¹ãƒˆ: ' : ''}æ–°è¨˜äº‹å®Œæˆ: ${data.title}`;
                  
                  const htmlContent = `
                  <!DOCTYPE html>
                  <html>
                  <head>
                      <meta charset="UTF-8">
                      <style>
                          body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f7fa; }
                          .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
                          .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
                          .header h1 { margin: 0; font-size: 24px; font-weight: 300; }
                          .header .subtitle { margin: 5px 0; opacity: 0.9; }
                          .content { padding: 30px; }
                          .success-box { background: #d4edda; border-left: 4px solid #28a745; padding: 20px; margin: 20px 0; border-radius: 5px; }
                          .test-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0; border-radius: 5px; }
                          .article-preview { background: #f8f9fa; border-left: 4px solid #007bff; padding: 20px; margin: 20px 0; border-radius: 5px; }
                          .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
                          .info-item { background: #e9ecef; padding: 15px; border-radius: 8px; }
                          .info-label { font-size: 12px; color: #666; margin-bottom: 5px; }
                          .info-value { font-weight: bold; color: #333; }
                          .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; font-size: 12px; }
                          .btn { display: inline-block; background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; margin: 10px 0; }
                          .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
                          .stat-item { background: #e9ecef; padding: 15px; border-radius: 8px; text-align: center; }
                          .stat-icon { font-size: 18px; font-weight: bold; color: #28a745; }
                          .stat-label { font-size: 11px; color: #666; margin-top: 5px; }
                      </style>
                  </head>
                  <body>
                      <div class="container">
                          <div class="header">
                              <h1>ğŸ‘ ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹</h1>
                              <div class="subtitle">AIè‡ªå‹•ãƒ–ãƒ­ã‚°ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </div>
                              <h2>ğŸ“„ æ–°è¨˜äº‹å®Œæˆé€šçŸ¥</h2>
                              ${data.isTestMode ? '<div class="subtitle">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å®Ÿè¡Œ</div>' : ''}
                          </div>
                          
                          <div class="content">
                              ${data.isTestMode ? `
                              <div class="test-box">
                                  <h3>ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å®Ÿè¡Œ</h3>
                                  <p>ã“ã‚Œã¯Gmailçµ±åˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§ã™ã€‚æ—¢å­˜ã®è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™ã€‚</p>
                              </div>
                              ` : ''}
                              
                              <div class="success-box">
                                  <h3>ğŸ‰ ${data.title}</h3>
                                  <div class="info-grid">
                                      <div class="info-item">
                                          <div class="info-label">è¨˜äº‹ç•ªå·</div>
                                          <div class="info-value">${data.index}/${data.total}</div>
                                      </div>
                                      <div class="info-item">
                                          <div class="info-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                                          <div class="info-value">${data.status}</div>
                                      </div>
                                  </div>
                              </div>
                              
                              <div class="stats">
                                  <div class="stat-item">
                                      <div class="stat-icon">âœ…</div>
                                      <div class="stat-label">RSSå–å¾—</div>
                                  </div>
                                  <div class="stat-item">
                                      <div class="stat-icon">âœ…</div>
                                      <div class="stat-label">è¨˜äº‹ç”Ÿæˆ</div>
                                  </div>
                                  <div class="stat-item">
                                      <div class="stat-icon">âœ…</div>
                                      <div class="stat-label">Notionä¿å­˜</div>
                                  </div>
                                  <div class="stat-item">
                                      <div class="stat-icon">âœ…</div>
                                      <div class="stat-label">Gmailé…ä¿¡</div>
                                  </div>
                              </div>
                              
                              <div class="article-preview">
                                  <h3>ğŸ“– è¨˜äº‹å†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                                  <p style="line-height: 1.6; color: #333; font-size: 14px;">
                                      ${data.content.substring(0, 400)}${data.content.length > 400 ? '...' : ''}
                                  </p>
                              </div>
                              
                              <div style="text-align: center;">
                                  <a href="${data.notionUrl}" class="btn">ğŸ“ Notionã§å…¨æ–‡ã‚’èª­ã‚€</a>
                              </div>
                              
                              <div class="success-box">
                                  <h3>ğŸš€ ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ³</h3>
                                  <p>Gmailçµ±åˆã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚${data.isTestMode ? 'ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ã«ã‚ˆã‚Šæ—¢å­˜è¨˜äº‹ã§ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚' : 'ä»Šå¾Œã€æ–°ã—ã„éŸ³å£°é…ä¿¡ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨ã€è‡ªå‹•çš„ã«è¨˜äº‹ãŒç”Ÿæˆã•ã‚Œã€ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚'}</p>
                              </div>
                              
                              <div class="info-grid">
                                  <div class="info-item">
                                      <div class="info-label">é€ä¿¡æ™‚åˆ»</div>
                                      <div class="info-value">${jstTime}</div>
                                  </div>
                                  <div class="info-item">
                                      <div class="info-label">ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ID</div>
                                      <div class="info-value">${data.episodeId || 'N/A'}</div>
                                  </div>
                              </div>
                          </div>
                          
                          <div class="footer">
                              <p>ğŸ¤– ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¾ã—ãŸ</p>
                              <p>ğŸ‘ ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹ AIè‡ªå‹•ãƒ–ãƒ­ã‚°ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </p>
                              <p>ğŸ“… ${jstTime} JST</p>
                              ${data.isTestMode ? '<p>ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å®Ÿè¡Œçµæœ</p>' : ''}
                          </div>
                      </div>
                  </body>
                  </html>
                  `;
                  
                  const message = `To: hitujikai.maruoka@gmail.com\r\nSubject: ${subject}\r\nContent-Type: text/html; charset=utf-8\r\n\r\n${htmlContent}`;
                  
                  const result = await gmail.users.messages.send({
                      userId: 'me',
                      requestBody: { 
                          raw: Buffer.from(message).toString('base64').replace(/\+/g, '-').replace(/\//g, '_') 
                      }
                  });
                  
                  console.log(`âœ… Gmailé€ä¿¡æˆåŠŸ [${data.index}]: ${result.data.id}`);
                  
              } catch (error) {
                  console.error(`âŒ Gmailé€ä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                  throw error;
              }
          }
          
          sendCompletionNotifications().catch(console.error);
          EOF
          
          # Gmailçµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
          node gmail-integration-main.js
          
      - name: ğŸ“Š å‡¦ç†çµæœã‚µãƒãƒªãƒ¼
        if: always()
        run: |
          echo "## ğŸ‘ ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹ å‡¦ç†çµæœ" >> $GITHUB_STEP_SUMMARY
          echo "**å®Ÿè¡Œæ™‚åˆ»ï¼ˆJSTï¼‰:** $(TZ=Asia/Tokyo date)" >> $GITHUB_STEP_SUMMARY
          echo "**å®Ÿè¡Œãƒˆãƒªã‚¬ãƒ¼:** ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰:** ${{ github.event.inputs.test_mode || 'false' }}" >> $GITHUB_STEP_SUMMARY
          echo "**Gmailçµ±åˆ:** âœ… æœ‰åŠ¹" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -f "data/processing_summary.json" ]; then
            echo "### ğŸ“‹ å‡¦ç†çµæœ" >> $GITHUB_STEP_SUMMARY
            echo '```json' >> $GITHUB_STEP_SUMMARY
            cat data/processing_summary.json >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          fi
          
      - name: ğŸ’¾ çµæœä¿å­˜
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: daily-results-${{ github.run_number }}
          path: data/
          retention-days: 30
          
      - name: ğŸ“§ ã‚¨ãƒ©ãƒ¼é€šçŸ¥ï¼ˆæœ¬æ ¼ãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰
        if: failure() && (github.event.inputs.test_mode != 'true')
        uses: actions/github-script@v7
        with:
          script: |
            const title = `âŒ ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹ æ¯æ—¥å‡¦ç†ã‚¨ãƒ©ãƒ¼ (${new Date().toLocaleDateString('ja-JP')})`;
            const body = `
            ## ğŸ‘ ç¾Šé£¼ã„ã¾ã‚‹ãŠã‹ æ¯æ—¥å‡¦ç†ã‚¨ãƒ©ãƒ¼å ±å‘Š
            
            **ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚åˆ»ï¼ˆJSTï¼‰:** ${new Date().toLocaleString('ja-JP', {timeZone: 'Asia/Tokyo'})}
            **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡ŒID:** ${{ github.run_id }}
            **Gmailçµ±åˆ:** æœ‰åŠ¹
            
            ### ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯
            - [å®Ÿè¡Œãƒ­ã‚°](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
            
            ### ğŸ”§ å¯¾å‡¦ãŒå¿…è¦ã§ã™
            1. å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã‚¨ãƒ©ãƒ¼åŸå› ã‚’ç‰¹å®š
            2. RSS URL ã‚„Notion APIæ¥ç¶šã‚’ç¢ºèª
            3. Gmailèªè¨¼æƒ…å ±ã®æœ‰åŠ¹æœŸé™ã‚’ç¢ºèª
            4. ä¿®æ­£å¾Œã€æ‰‹å‹•ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å†å®Ÿè¡Œ
            
            ### ğŸ“… æ¬¡å›ã®è‡ªå‹•å®Ÿè¡Œ
            æ˜æ—¥ã®21æ™‚ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™
            `;
            
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['bug', 'automation', 'daily-processing', 'gmail-integration']
            });
